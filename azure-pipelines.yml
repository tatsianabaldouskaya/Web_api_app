# ASP.NET
# Build and test ASP.NET projects.
# Add steps that publish symbols, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/apps/aspnet/build-aspnet-4

trigger:
- main

pool:
  vmImage: 'windows-latest'

variables:
  solution: '**/*.sln'
  buildPlatform: 'Any CPU'
  buildConfiguration: 'Release'
  variables:
  SONAR_HOST_URL: $(SONAR_HOST_URL)
  SONAR_TOKEN: $(SONAR_TOKEN)

steps:
  - task: UseDotNet@2
    displayName: 'Install SDK'
    inputs:
      version: '8.x'

  - checkout: self

  - task: DotNetCoreCLI@2
    displayName: 'Build the Project'
    inputs:
      command: 'build'
      projects: '**/*.csproj'

  - task: DotNetCoreCLI@2
    displayName: 'Run Unit Tests'
    inputs:
      command: 'test'
      projects: '**/Tests.csproj'
      arguments: '--filter FullyQualifiedName~Tests.UnitTests'

  - script: |
      dotnet tool install --global dotnet-sonarscanner
    displayName: 'Install SonarCloud Scanner'

  - script: |
      dotnet-sonarscanner begin /k:"Web_api_app" /o:"Tatsiana_Baldouskaya" /d:sonar.host.url=$(SONAR_HOST_URL) /d:sonar.login=$(SONAR_TOKEN)
    displayName: 'Prepare SonarCloud Analysis'
    env:
      SONAR_HOST_URL: $(SONAR_HOST_URL)
      SONAR_TOKEN: $(SONAR_TOKEN)